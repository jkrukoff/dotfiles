#!/bin/bash
sudo expect -f - -- "$@" <<'EOF'
set config "/etc/openvpn/UBNT.conf"
set username "john.krukoff@ubnt.com"
set password [lindex $argv 0]
set challenge [lindex $argv 1]

set send_slow {1 .1}
set timeout -1
spawn openvpn --config "$config" --errors-to-stderr
match_max 100000
expect -exact "Enter Auth Username: "
send -- "$username\r"
expect -exact "Enter Auth Password: "
send -- "$password\r"
expect -exact "CHALLENGE: Enter Google Authenticator Code "
send -- "$challenge\r"
expect eof
EOF
